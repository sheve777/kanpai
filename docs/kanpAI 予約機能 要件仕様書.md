# kanpAI 予約機能 要件仕様書

## 基本コンセプト

kanpAI予約機能は、営業時間内はLINEチャットボット、営業時間外は専用Webページを通じて24時間いつでも予約受付を可能にし、店主の業務負担を軽減しながら機会損失を防ぐシステムです。Googleカレンダーと連携することで、店主が慣れ親しんだツールで予約管理ができます。

---

## 予約受付方法

### 営業時間内：チャットボット予約
- **対応方法**: LINEチャット上での対話形式
- **利点**: 自然な会話で予約、質問も同時に可能
- **処理**: OpenAI APIを使用した対話型予約

### 営業時間外：専用予約ページ
- **対応方法**: LINEリッチメニューから専用Webページに遷移
- **利点**: 24時間利用可能、トークン消費ゼロ
- **処理**: Webフォーム形式での予約入力

### LINEリッチメニュー設定
- **予約ボタン配置**: 左上（最優先位置）
- **ボタン表記**: 「📅 予約する」
- **遷移先**: 営業時間により自動判別

### 営業時間外の案内
```
お客様: 「予約したいです」
Bot: 「申し訳ございません。営業時間外のため、下記よりご予約ください📅
↓予約ページ↓
[予約はこちら]ボタン」
```

---

## 予約受付条件

### 受付期間
- **当日予約**: 不可（断る）
- **受付範囲**: 翌日以降〜無制限
- **理由**: 当日は準備時間確保のため

### 受付時間
- **チャットボット予約**: 営業時間内のみ
- **専用予約ページ**: 24時間受付可能
- **時間刻み**: 30分単位（17:00, 17:30, 18:00...）
- **営業時間**: 営業時間内の予約のみ受付

### 人数制限
- **最小人数**: 1名から受付
- **最大人数**: 店舗ごとに設定可能
- **席種別制限**: 席種ごとに異なる人数制限設定可能

---

## 席種・座席管理

### 席種設定（店舗ごとカスタマイズ可能）
```
例：
- カウンター席：1-2名、5席
- テーブル席：3-6名、3席  
- 個室：4-10名、1席
```

### 席種選択
- **空きが1つ**: 自動で案内・確定
- **空きが複数**: お客様に選択してもらう
- **空きなし**: 「申し訳ございません、その時間は満席です」

### 利用時間設定
- **標準時間**: 2時間（店舗ごと変更可能）
- **自動設定**: 予約時間 + 利用時間で終了時間を自動計算
- **延長**: 当日店舗で相談

---

## Googleカレンダー連携

### 基本仕組み
- **予約確定時**: 自動でGoogleカレンダーに予定追加
- **予約情報**: カレンダー上で視覚的に確認可能
- **空き確認**: カレンダーの予定を見て自動判定

### カレンダー表示内容
- **タイトル**: 「田中太郎 4名 テーブル席」
- **内容**: 電話番号、備考（アレルギー、誕生日等）
- **時間**: 予約時間〜終了時間

### 営業時間・定休日管理
- **定休日設定**: 店主がGoogleカレンダーに0:00-24:00の予定を入れる
- **営業時間変更**: 該当時間に予定を入れる（例：17:00-19:00に「準備中」）
- **臨時休業**: 同様にカレンダーに予定を入れる
- **貸切対応**: 時間帯に「貸切」予定を入れる

### 予約不可の自動判定
- **既存予定がある時間**: 「その時間は既に予約が入っています」
- **定休日**: 「申し訳ございません、その日は定休日です」
- **営業時間外**: 「営業時間は17:00-24:00です」

---

## 予約受付フロー

### A. チャットボット予約（営業時間内）

#### 1. 予約意思確認
```
お客様: 「予約したいです」
Bot: 「ご予約承ります！お日にちはいつ頃をご希望ですか？」
```

#### 2. 必要情報の収集
##### 必須情報
- **お名前**: フルネーム
- **人数**: 正確な人数
- **希望日**: 具体的な日付
- **希望時間**: 30分刻みの時間
- **電話番号**: 連絡が取れる番号

##### 任意情報
- **席種**: 複数空きがある場合のみ
- **備考**: アレルギー、誕生日、記念日等

#### 3. 情報収集の流れ
```
Bot: 「お名前をお聞かせください」
お客様: 「田中太郎です」

Bot: 「ありがとうございます。何名様でしょうか？」
お客様: 「4名です」

Bot: 「4名様ですね。お日にちはいつ頃ご希望ですか？」
お客様: 「明日の19時」

Bot: 「確認いたします...申し訳ございません、明日19:00は既に予約が入っております。19:30はいかがでしょうか？」
```

#### 4. 最終確認
```
Bot: 「予約内容を確認させてください。

【予約内容】
・お名前：田中太郎様
・人数：4名
・日時：6月8日（土）19:30
・席種：テーブル席
・電話番号：090-1234-5678

こちらで間違いございませんか？」
```

#### 5. 予約確定・通知
```
Bot: 「ご予約を承りました！

【予約確定】
田中太郎様 4名
6月8日（土）19:30〜21:30
テーブル席

当日お気をつけてお越しください♪
楽しみにお待ちしております！」
```

### B. 専用予約ページ（営業時間外・24時間）

#### 1. アクセス方法
- **LINEリッチメニュー**: 「📅 予約する」ボタンから直接アクセス
- **URL**: 専用予約ページ（URL未定）
- **スマホ最適化**: 片手操作可能なWebフォーム

#### 2. 予約フォーム構成
```
【店舗名】ご予約フォーム

お名前 [必須]
[田中太郎        ]

お電話番号 [必須]  
[090-1234-5678   ]

人数 [必須]
[▼ 4名様          ]

ご希望日 [必須]
[📅 6月8日(土)     ]

ご希望時間 [必須]
[🕐 19:30         ]

席種 ※空きがある場合のみ表示
[○ テーブル席 ○ カウンター席]

ご要望・備考
[誕生日のお祝いです ]

[予約内容を確認する]
```

#### 3. 確認画面
```
【予約内容確認】

田中太郎様 4名
6月8日（土）19:30-21:30
テーブル席
TEL: 090-1234-5678
備考: 誕生日のお祝いです

[予約を確定する] [修正する]
```

#### 4. 完了画面
```
🎉 ご予約ありがとうございます！

【予約確定】
田中太郎様 4名  
6月8日（土）19:30-21:30
テーブル席

予約確認のご連絡をお送りしました。
当日お気をつけてお越しください♪

[LINEに戻る] [予約を追加する]
```

### C. 共通処理（両方式）
- **同一データベース**: 予約データは同じDBに保存
- **Googleカレンダー連携**: どちらも同じカレンダーに追加
- **通知システム**: 店主・お客様への通知は同じ
- **空き状況確認**: 同じロジックで空き判定

---

## エラー・例外処理

### 入力不備・不明な情報
- **名前未入力**: 「お名前をお聞かせください」
- **人数不明**: 「何名様でしょうか？」
- **日時曖昧**: 「具体的な日時をお聞かせください」
- **電話番号形式違い**: 「電話番号をハイフンありで教えてください（例：090-1234-5678）」

### 予約できない場合
- **満席**: 「申し訳ございません、その時間は満席です。○時や○時はいかがでしょうか？」
- **当日予約**: 「申し訳ございません、当日のご予約は承っておりません。お電話でお問い合わせください」
- **営業時間外**: 「営業時間は17:00-24:00となっております」
- **定休日**: 「申し訳ございません、その日は定休日です」

### システムエラー
- **Googleカレンダー接続エラー**: 「予約システムに不具合が発生しています。お電話でご予約ください」
- **重複予約防止**: 同時刻・同席種の重複チェック
- **タイムアウト**: 長時間返答がない場合は「予約を最初からやり直しますか？」

---

## キャンセル・変更対応

### 基本方針
- **キャンセル**: お店への直接連絡案内
- **変更**: お店への直接連絡案内
- **理由**: 複雑な処理を避け、確実性を重視

### キャンセル依頼時の対応
```
お客様: 「予約をキャンセルしたいです」

Bot: 「承知いたしました。
お手数ですが、お店に直接お電話いただけますでしょうか。

TEL: 03-XXXX-XXXX
営業時間: 17:00-24:00

マスターが迅速に対応いたします。」
```

### 店主側の処理
- **キャンセル受付**: 電話で受付
- **カレンダー削除**: 店主がGoogleカレンダーから手動削除
- **簡単操作**: 慣れ親しんだカレンダー操作

---

## 通知・確認システム

### お客様への通知
- **予約確定時**: LINE上で予約内容を表示
- **予約日前日**: 確認リマインダー（将来拡張）
- **内容**: 日時、席種、注意事項

### 店主への通知
- **予約確定時**: LINEまたはメールで即座通知
- **内容**: 予約詳細、お客様連絡先
- **カレンダー**: Googleカレンダーで視覚的確認

### 通知内容例
```
【新規予約】
田中太郎様 4名
6月8日（土）19:30-21:30
テーブル席
TEL: 090-1234-5678
備考: 誕生日のお祝い
```

---

## 予約データ管理

### 保存情報
- **予約ID**: システム内部管理用
- **店舗ID**: どの店舗の予約か
- **お客様情報**: 名前、電話番号
- **予約詳細**: 日時、人数、席種、備考
- **GoogleイベントID**: カレンダー連携用
- **ステータス**: 確定、キャンセル等

### データ保護
- **保存期間**: 予約日から1年後に自動削除
- **個人情報**: 暗号化して保存
- **アクセス制限**: 関係する店舗のみアクセス可能

---

## 店舗設定項目

### 予約受付設定
- **営業時間**: 何時〜何時まで予約受付
- **定休日**: 基本的な定休日設定
- **最大予約日数**: 何日先まで予約受付（デフォルト：無制限）

### 席種・座席設定
- **席種名**: カウンター、テーブル、個室など
- **各席種の座席数**: 物理的な席数
- **人数制限**: 最小〜最大人数
- **利用時間**: 標準利用時間（デフォルト2時間）

### 特別ルール
- **連続予約制限**: 同一顧客の連続予約制限
- **大人数対応**: 10名以上の場合の特別ルール
- **特別日設定**: 忘年会シーズン等の特別ルール

---

## 成功指標・KPI

### 基本指標
- **予約成功率**: 98%以上
- **予約完了時間**: 平均3分以内
- **情報入力エラー率**: 5%以下

### ビジネス指標
- **24時間予約率**: 営業時間外の予約取得率（専用ページ経由）
- **チャット vs Web予約比率**: 営業時間内外の予約方法比較
- **電話予約減少率**: 従来の電話予約からの移行率
- **キャンセル率**: 全予約に対するキャンセル率
- **予約完了率**: 予約開始から完了までの成功率（方式別）

### 運用効率
- **店主作業時間**: 予約関連業務の時間削減
- **ダブルブッキング**: ゼロ件（システムで防止）
- **顧客満足度**: 予約の簡単さ・確実性