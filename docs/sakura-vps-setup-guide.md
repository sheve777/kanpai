# ã•ãã‚‰VPS ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã‚¬ã‚¤ãƒ‰ - kanpAIå°å…¥å®Œå…¨ç‰ˆ

## ğŸ“‹ ç›®æ¬¡
1. [ã•ãã‚‰VPSç”³è¾¼ã¿æ‰‹é †](#1-ã•ãã‚‰vpsç”³è¾¼ã¿æ‰‹é †)
2. [åˆå›ãƒ­ã‚°ã‚¤ãƒ³ãƒ»ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¨­å®š](#2-åˆå›ãƒ­ã‚°ã‚¤ãƒ³ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¨­å®š)
3. [ã‚µãƒ¼ãƒãƒ¼ç’°å¢ƒæ§‹ç¯‰](#3-ã‚µãƒ¼ãƒãƒ¼ç’°å¢ƒæ§‹ç¯‰)
4. [kanpAIãƒ‡ãƒ—ãƒ­ã‚¤](#4-kanpaiãƒ‡ãƒ—ãƒ­ã‚¤)
5. [ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ»SSLè¨­å®š](#5-ãƒ‰ãƒ¡ã‚¤ãƒ³sslè¨­å®š)
6. [é‹ç”¨ãƒ»ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹](#6-é‹ç”¨ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹)

---

## 1. ã•ãã‚‰VPSç”³è¾¼ã¿æ‰‹é †

### 1.1 äº‹å‰æº–å‚™
**å¿…è¦ãªã‚‚ã®:**
- ã‚¯ãƒ¬ã‚¸ãƒƒãƒˆã‚«ãƒ¼ãƒ‰ã¾ãŸã¯éŠ€è¡Œå£åº§
- ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ï¼ˆé‡è¦ãªé€šçŸ¥ç”¨ï¼‰
- SSHæ¥ç¶šç”¨ç«¯æœ«ï¼ˆWindows: PowerShellã€Mac: Terminalï¼‰

### 1.2 ã•ãã‚‰VPSç”³è¾¼ã¿

**Step 1: ã•ãã‚‰ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆå…¬å¼ã‚µã‚¤ãƒˆã«ã‚¢ã‚¯ã‚»ã‚¹**
```
https://vps.sakura.ad.jp/
```

**Step 2: ãƒ—ãƒ©ãƒ³é¸æŠ**
```
æ¨å¥¨ãƒ—ãƒ©ãƒ³: 2GB
æ–™é‡‘: 1,848å††/æœˆï¼ˆç¨è¾¼ï¼‰
åˆæœŸè²»ç”¨: ç„¡æ–™

ã‚¹ãƒšãƒƒã‚¯:
- CPU: 3ã‚³ã‚¢
- ãƒ¡ãƒ¢ãƒª: 2GB
- SSD: 100GB
- è»¢é€é‡: ç„¡åˆ¶é™
```

**Step 3: ã‚µãƒ¼ãƒãƒ¼è¨­å®š**
```
ãƒ—ãƒ©ãƒ³: 2GB
ãƒªãƒ¼ã‚¸ãƒ§ãƒ³: çŸ³ç‹©ç¬¬1ã‚¾ãƒ¼ãƒ³ï¼ˆæ¨å¥¨ãƒ»æœ€æ–°è¨­å‚™ï¼‰
OS: Ubuntu 22.04 LTSï¼ˆæ¨å¥¨ï¼‰
ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã‚¿ã‚¤ãƒ—: æ¨™æº–
```

**Step 4: ç®¡ç†è€…æƒ…å ±å…¥åŠ›**
```
ãƒ¦ãƒ¼ã‚¶ãƒ¼å: ubuntuï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆæ¨å¥¨ï¼‰
ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰: å¼·åŠ›ãªãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰è¨­å®š
ï¼ˆå¤§æ–‡å­—ãƒ»å°æ–‡å­—ãƒ»æ•°å­—ãƒ»è¨˜å·ã‚’å«ã‚€12æ–‡å­—ä»¥ä¸Šï¼‰

ä¾‹: KanpAI2024!@#$
```

**Step 5: ãŠå®¢æ§˜æƒ…å ±ãƒ»æ”¯æ‰•ã„æ–¹æ³•**
- å€‹äººæƒ…å ±å…¥åŠ›
- ã‚¯ãƒ¬ã‚¸ãƒƒãƒˆã‚«ãƒ¼ãƒ‰æƒ…å ±ç™»éŒ²
- åˆ©ç”¨è¦ç´„åŒæ„

### 1.3 ã‚µãƒ¼ãƒãƒ¼ä½œæˆå®Œäº†
```
ä½œæˆæ™‚é–“: ç´„5-10åˆ†
å®Œäº†ãƒ¡ãƒ¼ãƒ«: ç™»éŒ²ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã«å±Šã

é‡è¦æƒ…å ±:
- ã‚µãƒ¼ãƒãƒ¼IPã‚¢ãƒ‰ãƒ¬ã‚¹
- åˆæœŸãƒ­ã‚°ã‚¤ãƒ³æƒ…å ±
- ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ãƒ‘ãƒãƒ«URL
```

---

## 2. åˆå›ãƒ­ã‚°ã‚¤ãƒ³ãƒ»ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¨­å®š

### 2.1 SSHæ¥ç¶šãƒ†ã‚¹ãƒˆ

**Windowsï¼ˆPowerShellï¼‰:**
```powershell
ssh ubuntu@YOUR_SERVER_IP
```

**Mac/Linux:**
```bash
ssh ubuntu@YOUR_SERVER_IP
```

åˆå›æ¥ç¶šæ™‚:
```
The authenticity of host 'YOUR_IP' can't be established.
ECDSA key fingerprint is SHA256:...
Are you sure you want to continue connecting (yes/no)? yes
```

### 2.2 ã‚·ã‚¹ãƒ†ãƒ æ›´æ–°
```bash
# ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãƒªã‚¹ãƒˆæ›´æ–°
sudo apt update

# ã‚·ã‚¹ãƒ†ãƒ å…¨ä½“æ›´æ–°
sudo apt upgrade -y

# å†èµ·å‹•ï¼ˆé‡è¦ãªæ›´æ–°ãŒã‚ã‚‹å ´åˆï¼‰
sudo reboot
```

### 2.3 ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¼·åŒ–

**SSHéµèªè¨¼è¨­å®šï¼ˆæ¨å¥¨ï¼‰:**
```bash
# ãƒ­ãƒ¼ã‚«ãƒ«ãƒã‚·ãƒ³ã§éµç”Ÿæˆ
ssh-keygen -t rsa -b 4096 -C "your-email@example.com"

# å…¬é–‹éµã‚’ã‚µãƒ¼ãƒãƒ¼ã«ã‚³ãƒ”ãƒ¼
ssh-copy-id ubuntu@YOUR_SERVER_IP

# SSHè¨­å®šå¼·åŒ–
sudo nano /etc/ssh/sshd_config
```

**SSHè¨­å®šå¤‰æ›´å†…å®¹:**
```
PasswordAuthentication no
PermitRootLogin no
Port 22022  # ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒãƒ¼ãƒˆå¤‰æ›´
```

**ãƒ•ã‚¡ã‚¤ã‚¢ã‚¦ã‚©ãƒ¼ãƒ«è¨­å®š:**
```bash
# UFWæœ‰åŠ¹åŒ–
sudo ufw enable

# SSHè¨±å¯ï¼ˆå¤‰æ›´ã—ãŸãƒãƒ¼ãƒˆã‚’æŒ‡å®šï¼‰
sudo ufw allow 22022

# HTTP/HTTPSè¨±å¯
sudo ufw allow 80
sudo ufw allow 443

# è¨­å®šç¢ºèª
sudo ufw status
```

### 2.4 åŸºæœ¬ãƒ„ãƒ¼ãƒ«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
```bash
# å¿…è¦ãªãƒ‘ãƒƒã‚±ãƒ¼ã‚¸
sudo apt install -y \
    curl \
    wget \
    git \
    unzip \
    htop \
    nano \
    fail2ban

# fail2banè¨­å®šï¼ˆãƒ–ãƒ«ãƒ¼ãƒˆãƒ•ã‚©ãƒ¼ã‚¹æ”»æ’ƒå¯¾ç­–ï¼‰
sudo systemctl enable fail2ban
sudo systemctl start fail2ban
```

---

## 3. ã‚µãƒ¼ãƒãƒ¼ç’°å¢ƒæ§‹ç¯‰

### 3.1 Docker ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
```bash
# Dockerå…¬å¼GPGã‚­ãƒ¼è¿½åŠ 
curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo gpg --dearmor -o /usr/share/keyrings/docker-archive-keyring.gpg

# Dockerãƒªãƒã‚¸ãƒˆãƒªè¿½åŠ 
echo "deb [arch=amd64 signed-by=/usr/share/keyrings/docker-archive-keyring.gpg] https://download.docker.com/linux/ubuntu $(lsb_release -cs) stable" | sudo tee /etc/apt/sources.list.d/docker.list > /dev/null

# ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸æ›´æ–°ãƒ»Docker ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
sudo apt update
sudo apt install -y docker-ce docker-ce-cli containerd.io

# Docker Compose ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
sudo curl -L "https://github.com/docker/compose/releases/latest/download/docker-compose-$(uname -s)-$(uname -m)" -o /usr/local/bin/docker-compose
sudo chmod +x /usr/local/bin/docker-compose

# ubuntuãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’dockerã‚°ãƒ«ãƒ¼ãƒ—ã«è¿½åŠ 
sudo usermod -aG docker ubuntu

# è¨­å®šåæ˜ ã®ãŸã‚å†ãƒ­ã‚°ã‚¤ãƒ³
exit
ssh ubuntu@YOUR_SERVER_IP
```

### 3.2 Dockerå‹•ä½œç¢ºèª
```bash
# Docker ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç¢ºèª
docker --version
docker-compose --version

# ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
docker run hello-world
```

### 3.3 å¿…è¦ãªãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªä½œæˆ
```bash
# kanpAIç”¨ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª
mkdir -p ~/kanpai
cd ~/kanpai

# ãƒ­ã‚°ãƒ»ãƒ‡ãƒ¼ã‚¿ç”¨ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª
mkdir -p logs uploads backups ssl
```

---

## 4. kanpAIãƒ‡ãƒ—ãƒ­ã‚¤

### 4.1 ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰å–å¾—
```bash
# Gitè¨­å®šï¼ˆåˆå›ã®ã¿ï¼‰
git config --global user.name "Your Name"
git config --global user.email "your-email@example.com"

# kanpAIã‚¯ãƒ­ãƒ¼ãƒ³
git clone https://github.com/YOUR_USERNAME/kanpAI.git
cd kanpAI
```

### 4.2 ç’°å¢ƒå¤‰æ•°è¨­å®š
```bash
# æœ¬ç•ªç’°å¢ƒè¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ä½œæˆ
cp .env.production .env

# ç’°å¢ƒå¤‰æ•°ç·¨é›†
nano .env
```

**å¿…é ˆè¨­å®šé …ç›®:**
```bash
# ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹
DB_PASSWORD=å¼·åŠ›ãªãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰è¨­å®š

# JWTèªè¨¼
JWT_SECRET=64æ–‡å­—ã®è‹±æ•°å­—ãƒ©ãƒ³ãƒ€ãƒ æ–‡å­—åˆ—

# å¤–éƒ¨APIï¼ˆå®Ÿéš›ã®å€¤ã«å¤‰æ›´ï¼‰
OPENAI_API_KEY=sk-proj-YOUR_ACTUAL_KEY
LINE_CHANNEL_ACCESS_TOKEN=YOUR_ACTUAL_TOKEN
STRIPE_API_KEY=sk_live_YOUR_ACTUAL_KEY

# ãƒ‰ãƒ¡ã‚¤ãƒ³ï¼ˆå–å¾—å¾Œã«è¨­å®šï¼‰
FRONTEND_URL=https://your-restaurant-domain.com
API_BASE_URL=https://api.your-restaurant-domain.com
```

### 4.3 kanpAIèµ·å‹•
```bash
# æœ¬ç•ªç’°å¢ƒã§ã‚³ãƒ³ãƒ†ãƒŠèµ·å‹•
docker-compose -f docker-compose.prod.yml up -d

# èµ·å‹•ç¢ºèª
docker-compose -f docker-compose.prod.yml ps

# ãƒ­ã‚°ç¢ºèª
docker-compose -f docker-compose.prod.yml logs -f
```

### 4.4 å‹•ä½œç¢ºèª
```bash
# ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯
curl http://localhost/api/health

# è©³ç´°ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹
curl http://localhost/api/health/detailed
```

---

## 5. ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ»SSLè¨­å®š

### 5.1 ãƒ‰ãƒ¡ã‚¤ãƒ³å–å¾—
**æ¨å¥¨æ¥­è€…:**
- ãŠåå‰.com: 1,408å††/å¹´ï¼ˆ.comï¼‰
- ãƒ ãƒ¼ãƒ ãƒ¼ãƒ‰ãƒ¡ã‚¤ãƒ³: 1,628å††/å¹´ï¼ˆ.comï¼‰
- ã•ãã‚‰ãƒ‰ãƒ¡ã‚¤ãƒ³: 1,886å††/å¹´ï¼ˆ.comï¼‰

### 5.2 DNSè¨­å®š
```
Aãƒ¬ã‚³ãƒ¼ãƒ‰è¨­å®š:
your-domain.com â†’ YOUR_SERVER_IP
www.your-domain.com â†’ YOUR_SERVER_IP
api.your-domain.com â†’ YOUR_SERVER_IP
```

### 5.3 SSLè¨¼æ˜æ›¸è¨­å®šï¼ˆLet's Encryptï¼‰
```bash
# Certbot ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
sudo apt install -y certbot python3-certbot-nginx

# è¨¼æ˜æ›¸å–å¾—
sudo certbot --nginx -d your-domain.com -d www.your-domain.com

# è‡ªå‹•æ›´æ–°è¨­å®š
sudo crontab -e
# ä»¥ä¸‹ã‚’è¿½åŠ 
0 12 * * * /usr/bin/certbot renew --quiet
```

### 5.4 Nginxè¨­å®šæ›´æ–°
```bash
# nginxè¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ç·¨é›†
nano nginx/nginx.conf

# ãƒ‰ãƒ¡ã‚¤ãƒ³åã‚’å®Ÿéš›ã®ã‚‚ã®ã«å¤‰æ›´
# your-domain.com â†’ å®Ÿéš›ã®ãƒ‰ãƒ¡ã‚¤ãƒ³å

# SSLè¨­å®šæœ‰åŠ¹åŒ–ï¼ˆã‚³ãƒ¡ãƒ³ãƒˆã‚¢ã‚¦ãƒˆè§£é™¤ï¼‰
```

---

## 6. é‹ç”¨ãƒ»ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹

### 6.1 å®šæœŸãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—è¨­å®š
```bash
# cronè¨­å®š
crontab -e

# æ¯æ—¥æ·±å¤œ2æ™‚ã«ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—å®Ÿè¡Œ
0 2 * * * cd ~/kanpai && docker-compose -f docker-compose.prod.yml run --rm backup node scripts/backup-database.js create
```

### 6.2 ç›£è¦–ãƒ»ã‚¢ãƒ©ãƒ¼ãƒˆè¨­å®š
```bash
# ã‚·ã‚¹ãƒ†ãƒ ç›£è¦–ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
nano ~/monitor.sh
```

**monitor.shå†…å®¹:**
```bash
#!/bin/bash
# kanpAIç›£è¦–ã‚¹ã‚¯ãƒªãƒ—ãƒˆ

HEALTH_URL="http://localhost/api/health"
EMAIL="your-email@example.com"

if ! curl -f $HEALTH_URL > /dev/null 2>&1; then
    echo "kanpAI system is down!" | mail -s "kanpAI Alert" $EMAIL
    # è‡ªå‹•å¾©æ—§è©¦è¡Œ
    cd ~/kanpai
    docker-compose -f docker-compose.prod.yml restart
fi
```

### 6.3 ãƒ­ã‚°ç®¡ç†
```bash
# ãƒ­ã‚°ãƒ­ãƒ¼ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³è¨­å®š
sudo nano /etc/logrotate.d/kanpai
```

**ãƒ­ã‚°ãƒ­ãƒ¼ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³è¨­å®š:**
```
~/kanpai/logs/*.log {
    daily
    rotate 30
    compress
    delaycompress
    missingok
    notifempty
    create 644 ubuntu ubuntu
}
```

### 6.4 å®šæœŸãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹
```bash
# æœˆæ¬¡ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
nano ~/monthly_maintenance.sh
```

**monthly_maintenance.sh:**
```bash
#!/bin/bash
# æœˆæ¬¡ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹

# ã‚·ã‚¹ãƒ†ãƒ æ›´æ–°
sudo apt update && sudo apt upgrade -y

# Docker ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—
docker system prune -f

# ãƒ­ã‚°ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—
find ~/kanpai/logs -name "*.log" -mtime +30 -delete

# å¤ã„ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—å‰Šé™¤ï¼ˆ30æ—¥ä»¥ä¸Šï¼‰
find ~/kanpai/backups -name "*.sql" -mtime +30 -delete
```

---

## ğŸš¨ ç·Šæ€¥æ™‚å¯¾å¿œ

### ã‚·ã‚¹ãƒ†ãƒ ãƒ€ã‚¦ãƒ³æ™‚
```bash
# 1. çŠ¶æ³ç¢ºèª
docker-compose -f docker-compose.prod.yml ps
docker-compose -f docker-compose.prod.yml logs

# 2. å†èµ·å‹•è©¦è¡Œ
docker-compose -f docker-compose.prod.yml restart

# 3. å®Œå…¨å†æ§‹ç¯‰ï¼ˆæœ€å¾Œã®æ‰‹æ®µï¼‰
docker-compose -f docker-compose.prod.yml down
docker-compose -f docker-compose.prod.yml up -d
```

### ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹å¾©æ—§
```bash
# ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ä¸€è¦§ç¢ºèª
ls -la backups/

# å¾©æ—§å®Ÿè¡Œ
docker-compose -f docker-compose.prod.yml run --rm backup node scripts/backup-database.js restore backups/BACKUP_FILE_NAME.sql
```

---

## ğŸ“ ã‚µãƒãƒ¼ãƒˆé€£çµ¡å…ˆ

**ã•ãã‚‰ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆ:**
- é›»è©±: 048-780-2066
- å—ä»˜: å¹³æ—¥ 10:00-18:00

**ç·Šæ€¥æ™‚ï¼ˆ24æ™‚é–“ï¼‰:**
- ã•ãã‚‰VPSã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ãƒ‘ãƒãƒ«
- ã‚µãƒãƒ¼ãƒˆãƒªã‚¯ã‚¨ã‚¹ãƒˆæ©Ÿèƒ½

---

**å®Œäº†ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ:**
- [ ] ã•ãã‚‰VPSç”³è¾¼ã¿ãƒ»åˆæœŸè¨­å®šå®Œäº†
- [ ] SSHéµèªè¨¼ãƒ»ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¨­å®šå®Œäº†  
- [ ] Dockerç’°å¢ƒæ§‹ç¯‰å®Œäº†
- [ ] kanpAIãƒ‡ãƒ—ãƒ­ã‚¤ãƒ»å‹•ä½œç¢ºèªå®Œäº†
- [ ] ãƒ‰ãƒ¡ã‚¤ãƒ³å–å¾—ãƒ»DNSè¨­å®šå®Œäº†
- [ ] SSLè¨¼æ˜æ›¸è¨­å®šå®Œäº†
- [ ] ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãƒ»ç›£è¦–è¨­å®šå®Œäº†

ã“ã®æ‰‹é †é€šã‚Šã«é€²ã‚ã‚Œã°ã€ãŠçˆ¶æ§˜ã®åº—èˆ—ç”¨kanpAIã‚·ã‚¹ãƒ†ãƒ ãŒå®‰å…¨ãƒ»å®‰å®šã—ã¦ç¨¼åƒã—ã¾ã™ï¼